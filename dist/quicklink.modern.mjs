function e(e,t,n,r){const o={headers:{accept:"*/*"}};return t||(o.mode="no-cors"),n&&(o.credentials="include"),o.priority=r?"high":"low",window.fetch?fetch(e,o):function(e,t){return new Promise((n,r,o)=>{(o=new XMLHttpRequest).open("GET",e,o.withCredentials=t),o.setRequestHeader("Accept","*/*"),o.onload=()=>{200===o.status?n():r()},o.send()})}(e,n)}const t=(n=document.createElement("link")).relList&&n.relList.supports&&n.relList.supports("prefetch")?function(e,t){return new Promise((n,r,o)=>{(o=document.createElement("link")).rel="prefetch",o.href=e,t&&o.setAttribute("crossorigin","anonymous"),o.onload=n,o.onerror=r,document.head.appendChild(o)})}:e;var n;const r=window.requestIdleCallback||function(e){const t=Date.now();return setTimeout(()=>{e({didTimeout:!1,timeRemaining:()=>Math.max(0,50-(Date.now()-t))})},1)},o=new Set,s=new Set;let i=!1;function c(e,t){return Array.isArray(t)?t.some(t=>c(e,t)):(t.test||t).call(t,e.href,e)}function a(e){if(e){if(e.saveData)return new Error("Save-Data is enabled");if(/2g/.test(e.effectiveType))return new Error("network conditions are poor")}return!0}function u(e={}){if(!window.IntersectionObserver||!("isIntersecting"in IntersectionObserverEntry.prototype))return;const[t,n]=function(e){e=e||1;var t=[],n=0;function r(){n<e&&t.length>0&&(t.shift()(),n++)}return[function(e){t.push(e)>1||r()},function(){n--,r()}]}(e.throttle||1/0),a=e.limit||1/0,u=e.threshold||0,h=e.origins||[location.hostname],d=e.ignores||[],m=e.delay||0,p=[],g=new Map,w=e.timeoutFn||r,v="function"==typeof e.hrefFn&&e.hrefFn,E=e.prerender||!1;i=e.prerenderAndPrefetch||!1;const y=new IntersectionObserver(r=>{r.forEach(r=>{if(r.isIntersecting)p.push((r=r.target).href),((e,t)=>{t?setTimeout(e,t):e()})(()=>{p.includes(r.href)&&(E||i||y.unobserve(r),(i||E)&&s.size<a&&!g.has(r.href)?f(v?v(r):r.href,e.eagerness).then(e=>{for(const[t,n]of e)g.set(t,n)}).catch(t=>{if(!e.onError)throw t;e.onError(t)}):o.size<a&&!E&&t(()=>{l(v?v(r):r.href,e.priority,e.checkAccessControlAllowOrigin,e.checkAccessControlAllowCredentials,e.onlyOnMouseover).then(n).catch(t=>{n(),e.onError&&e.onError(t)})}))},m);else{const e=p.indexOf((r=r.target).href);e>-1&&p.splice(e),g.has(r.href)&&g.set(function(e,t){const n=e.get(t);try{n.remove(),e.delete(t)}catch(e){return e}return e}(g,r.href))}})},{threshold:u});return w(()=>{(e.el&&e.el.length&&e.el.length>0&&"A"===e.el[0].nodeName?e.el:(e.el||document).querySelectorAll("a")).forEach(e=>{h.length&&!h.includes(e.hostname)||c(e,d)||y.observe(e)})},{timeout:e.timeout||2e3}),function(){o.clear(),y.disconnect()}}function l(n,r,c,u,l){const f=a(navigator.connection);return f instanceof Error?Promise.reject(new Error(`Cannot prefetch, ${f.message}`)):(s.size>0&&!i&&console.warn("[Warning] You are using both prefetching and prerendering on the same document"),Promise.all([].concat(n).map(n=>o.has(n)?[]:(o.add(n),function(e,t,n,...r){if(!n)return e(t,...r);const o=document.querySelectorAll(`a[href="${t}"]`),s=new Map;for(const n of o){const o=c=>{const a=setTimeout(()=>(n.removeEventListener("mouseenter",o),n.removeEventListener("mouseleave",i),e(t,...r)),200);s.set(n,a)},i=e=>{const t=s.get(n);t&&(clearTimeout(t),s.delete(n))};n.addEventListener("mouseenter",o),n.addEventListener("mouseleave",i)}}(r?e:t,new URL(n,location.href).toString(),l,c,u,r)))))}function f(e,t="immediate"){e=[].concat(e);const n=a(navigator.connection);if(n instanceof Error)return Promise.reject(new Error(`Cannot prerender, ${n.message}`));if(!HTMLScriptElement.supports("speculationrules"))return l(e,!0,!1,!1,"moderate"===t||"conservative"===t),Promise.reject(new Error("This browser does not support the speculation rules API. Falling back to prefetch."));for(const t of e)s.add(t);o.size>0&&!i&&console.warn("[Warning] You are using both prefetching and prerendering on the same document");const r=function(e,t){const n=new Map;try{for(const r of e){const e=document.createElement("script");e.type="speculationrules",e.text=JSON.stringify({prerender:[{source:"list",urls:[r],eagerness:t}]}),document.head.appendChild(e),n.set(r,e)}}catch(e){return e}return n}(e,t);return r.size>0?Promise.resolve(r):Promise.reject(r)}export{u as listen,l as prefetch,f as prerender};
